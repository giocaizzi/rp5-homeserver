# PostgreSQL configuration optimized for Raspberry Pi 5 8GB with swap
# Designed for n8n workload on limited resources with swap available

# Memory settings (adjusted for swap availability)
shared_buffers = 64MB                    # 25% of postgres memory limit
effective_cache_size = 256MB             # Increased - can use swap if needed
work_mem = 4MB                           # Increased for swap availability
maintenance_work_mem = 32MB              # Increased for swap availability

# Connection settings
max_connections = 20                     # Limited for Pi resources
superuser_reserved_connections = 3

# Write-ahead logging (WAL) settings
wal_level = replica                      # Minimal for single instance
max_wal_size = 128MB                     # Reduced for Pi storage
min_wal_size = 32MB
wal_compression = on                     # Save disk space
wal_buffers = 2MB

# Checkpoint settings
checkpoint_completion_target = 0.9       # Spread checkpoints over time
checkpoint_timeout = 15min               # Longer intervals for Pi

# Query planner settings
random_page_cost = 1.1                   # Optimistic for SSD storage
effective_io_concurrency = 2             # Conservative for Pi I/O

# Logging settings
log_min_duration_statement = 1000        # Log slow queries (1s+)
log_checkpoints = on
log_lock_waits = on
log_temp_files = 0

# Autovacuum settings (lighter for Pi)
autovacuum_max_workers = 2               # Reduced workers
autovacuum_vacuum_cost_limit = 100       # Slower vacuum to reduce I/O impact

# Background writer settings
bgwriter_delay = 200ms                   # Default
bgwriter_lru_maxpages = 100             # Reduced for Pi
bgwriter_lru_multiplier = 2.0

# Locale settings
lc_messages = 'en_US.utf8'
lc_monetary = 'en_US.utf8'
lc_numeric = 'en_US.utf8'
lc_time = 'en_US.utf8'
default_text_search_config = 'pg_catalog.english'

# Pi-specific optimizations
fsync = on                               # Keep for data safety
synchronous_commit = on                  # Keep for consistency
full_page_writes = on                    # Keep for crash safety